<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Detalhe da Rota</title>
    <link rel="stylesheet" href="./css/newDash.css">
</head>
<body>
    <div class="divTitulo" id="div_titulo">Dashboard</div>
    <h1 id="tituloRota"></h1>
    <ul id="listaPontos"></ul>

    <script>
        const idRota = sessionStorage.getItem('idRotaSelecionada');
        const nomeRota = sessionStorage.getItem('nomeRotaSelecionada');
        div_titulo.innerHTML = `<h2>Dashboard da Rota ${nomeRota}</h2>`;
        document.getElementById('tituloRota').innerText = `Pontos de Coleta da Rota: ${nomeRota}`;

        fetch("/dashboard/pontosPorRota", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ idRotaServer: idRota })
        })
        .then(res => res.json())
        .then(pontos => {
            console.log(pontos);
            const ul = document.getElementById('listaPontos');
            pontos.forEach(ponto => {
                let nivel;
                if(ponto.media_nivel_lixo <= 18 && ponto.media_nivel_lixo >= 0){
                    cor = "red";
                    nivel = 5;
                }
                else if (ponto.media_nivel_lixo > 18 && ponto.media_nivel_lixo <= 36) {
                    cor = "red";
                    nivel = 4;
                } else if (ponto.media_nivel_lixo > 36 && ponto.media_nivel_lixo <= 54) {
                    cor = "yellow";
                    nivel = 3;

                } else if (ponto.media_nivel_lixo > 54 && ponto.media_nivel_lixo <= 72) {
                    cor = "lawngreen";
                    nivel = 2;
                } else if(ponto.media_nivel_lixo > 72 && ponto.media_nivel_lixo <= 100){
                    cor = "lawngreen";
                    nivel = 1;
                }

                ul.innerHTML += `
                    <li onclick="abrirDetalhePonto(${ponto.idPontoColeta}, '${ponto.logradouro}')" 
                        style="background-color:${cor}; border-radius:10%; margin:10px; display:flex; text-align:center; padding:10px; cursor:pointer;">
                        <img src="./imgs/trash-512.webp" alt="Lixeira" style="width:30px; height:30px; margin-right:10px;">
                        <span>
                            ${ponto.logradouro} - ${ponto.bairro} 
                            <b style="margin-left:10px;">NÃ­vel: ${nivel}</b>
                        </span>
                    </li>
                `;
            });
        });

function abrirDetalhePonto(idPontoColeta, logradouro) {
    sessionStorage.setItem('idPontoColetaSelecionado', idPontoColeta);
    sessionStorage.setItem('logradouroSelecionado', logradouro);
    window.location.href = "detalhePonto.html";
}

    </script>
</body>
</html>